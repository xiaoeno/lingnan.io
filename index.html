<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1,user-scalable=no"/>
  <title>加密密码生成器</title>
  <style>
    *{box-sizing:border-box;margin:0;padding:0}
    html,body{height:100%;background:#f7f7f7;font-family:-apple-system,BlinkMacSystemFont,"Helvetica Neue",Helvetica,"PingFang SC","Hiragino Sans GB","Microsoft YaHei",Arial,sans-serif}
    .wrap{padding:20px 15px;max-width:500px;margin:0 auto}
    h2{text-align:center;margin-bottom:25px;font-size:24px;color:#333}
    .row{margin-bottom:18px}
    label{display:block;font-size:17px;color:#555;margin-bottom:6px}
    input[type=text],input[type=date]{
      width:100%;
      height:48px;
      font-size:18px;
      padding:0 12px;
      border:1px solid #ccc;
      border-radius:6px;
      -webkit-appearance:none;
    }
    button{
      width:100%;
      height:52px;
      font-size:20px;
      color:#fff;
      background:#007bff;
      border:0;
      border-radius:8px;
      margin-top:25px;
      cursor:pointer;
      -webkit-appearance:none;
    }
    button:active{background:#0056b3}
    .result{margin-top:25px}
    .result input{
      font-weight:bold;color:#d00;
      font-size:20px;
      text-align:center;
      letter-spacing:1px;
    }
    /* 全屏提示 */
    #fsBtn{
      margin-top:15px;
      background:#28a745;
      font-size:16px;
      height:44px;
    }
  </style>
</head>
<body>
  <div class="wrap">
    <h2>加密密码生成器</h2>

    <div class="row">
      <label>授权天数（9999 永久）：</label>
      <input type="text" id="p" value="9999" inputmode="numeric"/>
    </div>

    <div class="row">
      <label>设备序列号：</label>
      <input type="text" id="k" value="1" inputmode="numeric"/>
    </div>

    <div class="row">
      <label>今日日期（与触摸屏一致）：</label>
      <input type="date" id="date"/>
    </div>

    <button onclick="gen()">生成密码</button>

    <div class="result">
      <label>结果密码：</label>
      <input type="text" id="pwd" readonly/>
    </div>

    <!-- 可选：手动全屏 -->
    <!-- <button id="fsBtn" onclick="goFullscreen()">全屏显示</button> -->
  </div>

  <script>
    const digitSum = n => n.toString().split('').reduce((s,c)=>s+ +c, 0);

    function encrypt(P, K, day){
      const dayStr = String(day).padStart(2,'0');
      const P0 = parseInt(`${P}${dayStr}`, 10);
      const S  = P0 ^ (K + 2048);
      const E  = ((S & 0xFFF) << 12) | (S >>> 12);
      return `${E}${String(digitSum(P0)).padStart(2,'0')}`;
    }

    function gen(){
      const P = parseInt(document.getElementById('p').value, 10);
      const K = parseInt(document.getElementById('k').value, 10);
      const d = new Date(document.getElementById('date').value);
      if(!Number.isFinite(P) || !Number.isFinite(K)) return alert('请输入有效数字！');
      if(isNaN(d)) return alert('请选择日期！');
      console.log(d.getFullYear())
      console.log(d.getMonth())
      document.getElementById('pwd').value = encrypt(P, (K + d.getFullYear() + d.getMonth() + 1), d.getDate());
    }

    document.getElementById('date').valueAsDate = new Date();
    gen();

    function goFullscreen(){
      const el = document.documentElement;
      if(el.requestFullscreen) el.requestFullscreen();
      else if(el.webkitRequestFullscreen) el.webkitRequestFullscreen();
      else if(el.msRequestFullscreen) el.msRequestFullscreen();
    }
  </script>
</body>
</html>
